<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>ÜV-Listen-Generator</title>
  <style>
    body { background:#111; color:#eee; font-family:sans-serif; }
    .box { padding:20px; max-width:900px; margin:auto; }
    table { width:100%; border-collapse:collapse; margin-top:15px; }
    th, td { padding:6px 10px; border-bottom:1px solid #333; }
    th { background:#222; }
    button { background:#f90; border:none; padding:10px 16px; cursor:pointer; font-weight:bold; border-radius:6px; }
    input, select { padding:8px; margin:4px; background:#222; color:#fff; border:1px solid #444; border-radius:4px; }
  </style>
</head>
<body>
  <div class="box">
    <h2>ÜV-Listen-Generator (Live via FUTDATABASE)</h2>
    <p>EA-Tax 5 %, Zielprofit ~1.000, Mindestprofit 800, Rundung 100 • Buy = BIN – Abschlag%</p>
    <div>
      <label>Plattform</label>
      <select id="platform">
        <option value="ps">Playstation</option>
        <option value="xbox">Xbox</option>
        <option value="pc">PC</option>
      </select>
      <label>Budget (Coins)</label>
      <input type="number" id="budget" value="100000">
      <label>Listengröße</label>
      <input type="number" id="size" value="100">
      <label>Marktpreis-Abschlag (%)</label>
      <input type="number" id="discount" value="3">
      <button onclick="createList()">Erstellen</button>
      <button onclick="testAPI()">API testen</button>
    </div>
    <table id="table">
      <thead>
        <tr><th>Spieler</th><th>Pos</th><th>OVR</th><th>BIN</th><th>Chemstyle</th><th>Kaufpreis</th><th>Verkaufspreis</th><th>Profit</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
<script>
async function testAPI(){
  const r = await fetch('/api/futdb?type=test');
  const j = await r.json();
  alert('API erreichbar: ' + JSON.stringify(j));
}
async function createList(){
  const plat = document.getElementById('platform').value;
  const budget = parseInt(document.getElementById('budget').value);
  const size = parseInt(document.getElementById('size').value);
  const discount = parseInt(document.getElementById('discount').value);
  const r = await fetch('/api/futdb?type=players');
  const j = await r.json();
  if(!j || !j.items){ alert('Fehler beim Laden der Spieler'); return; }
  const tbody = document.querySelector('#table tbody');
  tbody.innerHTML='';
  let used=0;
  for(const p of j.items){
    if(used>=size) break;
    const pr = await fetch('/api/futdb?type=price&playerId='+p.id+'&platform='+plat);
    const pj = await pr.json();
    if(!pj || !pj.lowestBin) continue;
    const bin = pj.lowestBin;
    if(bin<=0 || bin>budget) continue;
    const buy = Math.floor(bin*(1-discount/100)/100)*100;
    const sell = bin;
    const profit = Math.floor(sell*0.95 - buy);
    if(profit<800) continue;
    const tr = document.createElement('tr');
    tr.innerHTML = '<td>'+p.name+'</td><td>'+p.position+'</td><td>'+p.rating+'</td><td>'+bin+'</td><td>'+ (p.chemistry_style || '-') +'</td><td>'+buy+'</td><td>'+sell+'</td><td>'+profit+'</td>';
    tbody.appendChild(tr);
    used++;
  }
}
</script>
</body>
</html>
